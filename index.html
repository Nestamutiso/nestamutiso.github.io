<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindCheck Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7d5fff; --bg: #fdfbff; --text: #1e272e;
            --card: #ffffff; --bot: #7d5fff; --user: #efedff;
        }
        body.dark-mode {
            --bg: #121212; --text: #e0e0e0; --card: #1e1e1e;
            --user: #2d2d2d; --bot: #a29bfe;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); margin: 0; color: var(--text); height: 100vh; overflow: hidden; }

        /* --- Login Overlay --- */
        #login-screen {
            position: fixed; inset: 0; background: var(--primary); z-index: 9999;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .login-box { background: white; padding: 40px; border-radius: 30px; width: 100%; max-width: 350px; text-align: center; }
        input { width: 100%; padding: 15px; margin: 15px 0; border-radius: 12px; border: 1px solid #ddd; outline: none; }
        button.main-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; }

        /* --- App Layout --- */
        .view { display: none; height: 100vh; flex-direction: column; padding: 20px 20px 100px; overflow-y: auto; }
        .view.active { display: flex; }

        /* --- Chat --- */
        #chat-log { flex: 1; display: flex; flex-direction: column; gap: 10px; padding-top: 20px; }
        .bubble { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.4; }
        .bot-msg { background: var(--bot); color: white; align-self: flex-start; border-bottom-left-radius: 2px; }
        .user-msg { background: var(--user); color: var(--text); align-self: flex-end; border-bottom-right-radius: 2px; }

        .input-area { display: flex; gap: 10px; padding: 10px; background: var(--card); border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        #chat-input { flex: 1; border: none; background: transparent; color: var(--text); outline: none; padding: 5px; }

        /* --- Insights/Calendar --- */
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px; }
        .dot { height: 30px; background: #eee; border-radius: 5px; }
        .dot.good { background: #2ed573; }
        .dot.heavy { background: var(--primary); }

        /* --- Navigation --- */
        nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 80px;
            background: #1e272e; display: flex; justify-content: space-around; align-items: center;
        }
        .nav-item { background: none; border: none; color: #808e9b; font-size: 24px; cursor: pointer; padding: 10px; }
        .nav-item.active { color: white; border-top: 3px solid white; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#333">MindCheck</h2>
            <input type="text" id="user-name" placeholder="Enter your name">
            <button class="main-btn" onclick="app.login()">Get Started</button>
        </div>
    </div>

    <div id="view-home" class="view active">
        <header><h1 id="greet">Hello</h1></header>
        <div id="chat-log"></div>
        <div class="input-area">
            <input type="text" id="chat-input" placeholder="Type a thought..." autocomplete="off">
            <button onclick="app.send()" style="border:none; background:none; font-size:20px; cursor:pointer;">üöÄ</button>
        </div>
    </div>

    <div id="view-insights" class="view">
        <header><h1>Your Vibe</h1></header>
        <div style="background:var(--card); padding:20px; border-radius:20px; margin-bottom:20px;">
            <h3>Mood Calendar</h3>
            <div class="grid" id="calendar-grid">
                </div>
        </div>
        <div id="crisis-alert" style="display:none; background:#ff4757; color:white; padding:20px; border-radius:20px;">
            <h3>Need Help?</h3>
            <p>I detected some heavy words. Please call 0722178177.</p>
        </div>
    </div>

    <div id="view-settings" class="view">
        <header><h1>Settings</h1></header>
        <div style="background:var(--card); padding:20px; border-radius:20px;">
            <button class="main-btn" onclick="app.toggleDark()" style="margin-bottom:10px;">Toggle Dark Mode</button>
            <button class="main-btn" onclick="app.logout()" style="background:#ff4757">Logout</button>
        </div>
    </div>

    <nav>
        <button class="nav-item active" onclick="app.nav('home', this)">üè†</button>
        <button class="nav-item" onclick="app.nav('insights', this)">üìä</button>
        <button class="nav-item" onclick="app.nav('settings', this)">‚öôÔ∏è</button>
    </nav>

    <script>
        // Use a single object to prevent "not defined" errors
        const app = {
            name: "",
            moods: [],
            
            login: function() {
                const val = document.getElementById('user-name').value;
                if(!val) return alert("Enter name");
                this.name = val;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('greet').innerText = "Hi, " + val;
                this.addBubble("Welcome " + val + ". I'm your thought partner. How is your heart today?", "bot");
            },

            nav: function(viewId, btn) {
                // Remove active from all views
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                // Show selected view
                document.getElementById('view-' + viewId).classList.add('active');
                // Handle Nav buttons
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                btn.classList.add('active');
                if(viewId === 'insights') this.renderCalendar();
            },

            send: function() {
                const input = document.getElementById('chat-input');
                const text = input.value.trim();
                if(!text) return;

                this.addBubble(text, "user");
                input.value = "";

                // Simple AI reasoning
                setTimeout(() => {
                    let reply = "Tell me more about that.";
                    if(text.match(/sad|bad|hard|tired/i)) {
                        reply = "I hear you. It sounds heavy. I'm right here.";
                        this.moods.push('heavy');
                        document.getElementById('crisis-alert').style.display = 'block';
                    } else if(text.match(/good|happy|win/i)) {
                        reply = "That's a win! I'm happy for you.";
                        this.moods.push('good');
                    }
                    this.addBubble(reply, "bot");
                }, 700);
            },

            addBubble: function(msg, side) {
                const log = document.getElementById('chat-log');
                const div = document.createElement('div');
                div.className = side === "bot" ? "bubble bot-msg" : "bubble user-msg";
                div.innerText = msg;
                log.appendChild(div);
                log.scrollTop = log.scrollHeight;
            },

            renderCalendar: function() {
                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = "";
                for(let i=0; i<7; i++) {
                    const d = document.createElement('div');
                    d.className = "dot";
                    if(this.moods[i] === 'good') d.className = "dot good";
                    if(this.moods[i] === 'heavy') d.className = "dot heavy";
                    grid.appendChild(d);
                }
            },

            toggleDark: function() {
                document.body.classList.toggle('dark-mode');
            },

            logout: function() {
                location.reload();
            }
        };

        // Allow Enter key to send
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') app.send();
        });
    </script>
</body>
</html>
