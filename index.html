<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindCheck | Super App</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7d5fff; --bg: #fdfbff; --text: #1e272e;
            --card: #ffffff; --user-bubble: #efedff; --bot-bubble: #7d5fff;
            --danger: #ff4757; --success: #2ed573; --subtle: #a4b0be;
        }
        body.dark-mode {
            --bg: #121212; --text: #e0e0e0; --card: #1e1e1e;
            --user-bubble: #2d2d2d; --bot-bubble: #a29bfe;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); margin: 0; color: var(--text); height: 100vh; overflow: hidden; transition: 0.3s; }

        /* --- Login Screen --- */
        #auth-screen { position: fixed; inset: 0; background: var(--primary); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: white; padding: 40px; border-radius: 35px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .auth-card input { width: 100%; padding: 15px; margin: 15px 0; border-radius: 15px; border: 2px solid #eee; outline: none; font-size: 16px; }

        /* --- App Layout --- */
        .app-shell { height: 100vh; display: none; flex-direction: column; }
        .view { display: none; flex: 1; overflow-y: auto; padding: 20px 20px 120px; }
        .view.active { display: flex; flex-direction: column; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; } }

        header { padding: 20px 5px; flex-shrink: 0; }
        .app-card { background: var(--card); border-radius: 25px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }

        /* --- Chat Interface --- */
        #chat-log { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; margin-bottom: 10px; padding-bottom: 10px; }
        .bubble { max-width: 85%; padding: 14px 18px; border-radius: 22px; font-size: 15px; line-height: 1.5; }
        .bot { background: var(--bot-bubble); color: white; align-self: flex-start; border-bottom-left-radius: 4px; }
        .user { background: var(--user-bubble); color: var(--text); align-self: flex-end; border-bottom-right-radius: 4px; }

        .input-bar { background: var(--card); padding: 10px; border-radius: 30px; display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        #user-input { flex: 1; border: none; background: transparent; color: var(--text); padding: 10px; outline: none; font-size: 16px; }

        /* --- Mood Calendar --- */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 15px; }
        .cal-day { height: 35px; border-radius: 8px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; transition: 0.3s; }

        /* --- Nav --- */
        nav { position: fixed; bottom: 25px; left: 20px; right: 20px; background: #1e272e; height: 75px; border-radius: 38px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-btn { background: none; border: none; color: #808e9b; font-size: 24px; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: white; transform: translateY(-5px); }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-card">
            <h1 style="margin:0">üåø</h1>
            <h2 style="color:#333">MindCheck Pro</h2>
            <p style="color:#666">Your personal AI thought partner.</p>
            <input type="text" id="username" placeholder="What's your name?">
            <button onclick="login()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:15px; font-weight:700; cursor:pointer;">Launch App</button>
        </div>
    </div>

    <div class="app-shell" id="app-shell">
        <main id="home" class="view active">
            <header><h1 id="greet" style="margin:0">Hi</h1></header>
            <div id="chat-log"></div>
            <div class="input-bar">
                <input type="text" id="user-input" placeholder="Speak your mind..." autocomplete="off">
                <button onclick="handleSend()" style="background:var(--primary); color:white; border:none; width:45px; height:45px; border-radius:50%; cursor:pointer;">‚Üë</button>
            </div>
        </main>

        <main id="insights" class="view">
            <header><h1>Daily Insights</h1></header>
            <div class="app-card">
                <h3>Mood Tracker</h3>
                <div class="calendar-grid" id="calendar"></div>
                <p style="font-size:12px; color:var(--subtle); margin-top:10px;">Showing your vibe from the last 7 sessions.</p>
            </div>
            <div class="app-card">
                <h3>Vibe Check</h3>
                <p id="vibe-text" style="color:var(--subtle); font-size:14px;">Log a thought to generate your vibe.</p>
                <button onclick="updateVibeUI()" style="width:100%; padding:10px; border-radius:12px; border:none; background:var(--primary); color:white; font-weight:bold;">Refresh Vibe</button>
            </div>
            <div id="crisis-mode" style="display:none; background:#fff5f5; border: 2px solid var(--danger); padding:20px; border-radius:25px;">
                <h3 style="color:var(--danger); margin:0;">You are not alone.</h3>
                <p style="font-size:13px; color:#333;">I've detected some heavy thoughts. Help is available right now.</p>
                <button onclick="window.open('tel:0722178177')" style="width:100%; padding:12px; background:var(--danger); color:white; border:none; border-radius:10px; font-weight:bold;">Call Befrienders Kenya</button>
            </div>
        </main>

        <main id="settings" class="view">
            <header><h1>Settings</h1></header>
            <div class="app-card">
                <p>Profile: <b id="u-display">...</b></p>
                <div style="display:flex; justify-content: space-between; align-items: center; padding: 15px 0; border-top: 1px solid #eee;">
                    <span>Dark Mode</span>
                    <button onclick="document.body.classList.toggle('dark-mode')" style="padding:8px 18px; border-radius:10px; border:none; background:#f1f2f6; cursor:pointer;">Toggle</button>
                </div>
                <button onclick="localStorage.clear(); location.reload();" style="width:100%; padding:15px; background:#ffebee; color:red; border:none; border-radius:15px; margin-top:20px; font-weight:700;">Logout & Reset Memory</button>
            </div>
        </main>

        <nav>
            <button class="nav-btn active" onclick="tab('home', this)">üè†</button>
            <button class="nav-btn" onclick="tab('insights', this)">üìä</button>
            <button class="nav-btn" onclick="tab('settings', this)">‚öôÔ∏è</button>
        </nav>
    </div>

    <script>
        let userName = "";
        let moodScore = 0;
        let moodHistory = JSON.parse(localStorage.getItem('mind_mood_history')) || [];

        function login() {
            userName = document.getElementById('username').value;
            if(!userName.trim()) return alert("Please enter your name");
            localStorage.setItem('mind_super_user', userName);
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-shell').style.display = 'flex';
            document.getElementById('u-display').innerText = userName;
            renderCalendar();
            initApp();
        }

        function initApp() {
            const hr = new Date().getHours();
            const greet = hr < 12 ? "Morning, " : hr < 18 ? "Afternoon, " : "Evening, ";
            document.getElementById('greet').innerText = greet + userName;
            addBubble(`Hey ${userName}. I'm locked in and listening. How's the world treating you today?`, 'bot');
        }

        function tab(id, btn) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function handleSend() {
            const input = document.getElementById('user-input');
            const val = input.value.trim();
            if(!val) return;
            addBubble(val, 'user');
            input.value = "";

            // Crisis Monitor
            if(val.toLowerCase().match(/kill|suicide|die|end it|hurt myself|danger|help/)) {
                document.getElementById('crisis-mode').style.display = 'block';
            }

            setTimeout(() => {
                const response = getAIResponse(val.toLowerCase());
                addBubble(response, 'bot');
            }, 800);
        }

        function addBubble(txt, side) {
            const log = document.getElementById('chat-log');
            const div = document.createElement('div');
            div.className = `bubble ${side}`;
            div.innerText = txt;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function getAIResponse(input) {
            // Empathy Pools
            const sadPool = ["I hear you, and I can tell it's heavy right now. It's okay to sit with that‚ÄîI'm right here.", "I feel the weight in your words. You don't have to 'be strong' for me. What's the toughest part today?", "That sounds incredibly hard. I'm listening. Is this something you've been carrying for a while?"];
            const joyPool = ["I love that for you! ‚ú® You deserve every bit of that light. What was the highlight?", "That's a huge win! Keep protecting that peace. How are you going to celebrate today?", "Wonderful! It‚Äôs great when things start to align. What's one thing you're grateful for right now?"];
            const neutralPool = ["I'm curious‚Äîhas this been on your mind for a while?", "That's an interesting perspective. How are you honestly navigating that in your head?", "I see. If you had to describe the vibe of your day in one word, what would it be?"];

            if (input.match(/sad|hurt|fail|lonely|tired|bad|difficult|cry|heavy|exhausted/)) {
                moodScore--;
                saveMood('low');
                return sadPool[Math.floor(Math.random() * sadPool.length)];
            } else if (input.match(/happy|good|great|won|amazing|love|win|smile/)) {
                moodScore++;
                saveMood('high');
                return joyPool[Math.floor(Math.random() * joyPool.length)];
            }
            return neutralPool[Math.floor(Math.random() * neutralPool.length)];
        }

        function saveMood(type) {
            if(moodHistory.length >= 7) moodHistory.shift();
            moodHistory.push(type);
            localStorage.setItem('mind_mood_history', JSON.stringify(moodHistory));
            renderCalendar();
        }

        function renderCalendar() {
            const cal = document.getElementById('calendar');
            cal.innerHTML = "";
            for(let i=0; i<7; i++) {
                const day = document.createElement('div');
                day.className = 'cal-day';
                const status = moodHistory[i];
                if(status === 'high') day.style.background = 'var(--success)';
                else if(status === 'low') day.style.background = 'var(--primary)';
                day.innerText = "D" + (i+1);
                cal.appendChild(day);
            }
        }

        function updateVibeUI() {
            const vibe = document.getElementById('vibe-text');
            if(moodScore < 0) vibe.innerText = "Current Vibe: Reflective & Tender. You've been carrying a lot. Be gentle with yourself.";
            else if(moodScore > 0) vibe.innerText = "Current Vibe: Radiant & Growing! You're focusing on wins and positive momentum.";
            else vibe.innerText = "Current Vibe: Balanced. You're staying present and doing the work.";
        }

        window.onload = () => {
            const saved = localStorage.getItem('mind_super_user');
            if(saved) { document.getElementById('username').value = saved; login(); }
        }

        document.getElementById('user-input').addEventListener('keypress', e => { if(e.key === 'Enter') handleSend(); });
    </script>
</body>
</html>
